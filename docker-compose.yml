version: '3.8'

services:
  # =======================================================
  # ðŸš€ Disaster Management System (React + TypeScript App)
  # =======================================================
  web:
    build:
      context: .                      # Build from the current directory
      dockerfile: Dockerfile          # Uses the Dockerfile in this folder
    container_name: disaster-web
    restart: unless-stopped
    ports:
      - "3000:80"                     # App accessible at http://localhost:3000
    environment:
      - NODE_ENV=production
    depends_on:
      - redis
      - graphite
      - grafana

  # =======================================================
  # ðŸ§  Redis (Caching Layer)
  # =======================================================
  redis:
    image: redis:7-alpine
    container_name: uptime-redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

  # =======================================================
  # ðŸ“Š Graphite + Carbon (Metrics Storage)
  # =======================================================
  graphite:
    image: graphiteapp/graphite-statsd:latest
    container_name: uptime-graphite
    restart: unless-stopped
    ports:
      - "8081:80"           # Graphite Web UI
      - "2003:2003"         # Carbon plaintext receiver
      - "2004:2004"         # Carbon pickle receiver
      - "8125:8125/udp"     # StatsD UDP
      - "8126:8126"         # StatsD admin
    volumes:
      - graphite-data:/opt/graphite/storage
    environment:
      - GRAPHITE_TIME_ZONE=UTC

  # =======================================================
  # ðŸ“ˆ Grafana (Visualization Dashboard)
  # =======================================================
  grafana:
    image: grafana/grafana:latest
    container_name: uptime-grafana
    restart: unless-stopped
    ports:
      - "3001:3000"          # Grafana at http://localhost:3001
    volumes:
      - grafana-data:/var/lib/grafana
      - ./grafana/provisioning:/etc/grafana/provisioning
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_USERS_ALLOW_SIGN_UP=false
    depends_on:
      - graphite

# =======================================================
# ðŸ”’ Persistent Volumes
# =======================================================
volumes:
  graphite-data:
  grafana-data:
  redis-data:
